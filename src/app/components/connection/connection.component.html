<div class="flex justify-center items-center h-screen bg-gray-50 p-4 w-full overflow-hidden font-sans">
  <!-- Settings Icon (Top Right) -->
  <button
    class="fixed top-6 right-6 w-14 h-14 flex items-center justify-center bg-white rounded-2xl hover:bg-gray-50 transition-all duration-300 cursor-pointer border border-gray-200 shadow-lg hover:shadow-xl z-50 group"
    (click)="openApiConfig()" title="Configure API">
    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 448 448" fill="currentColor"
      class="text-blue-600 group-hover:rotate-90 transition-transform duration-500 ease-in-out">
      <path
        d="m 332.69839,-0.3359 c -37.2224,1.0088 -74.05574,22.5332 -92.75974,55.85353 -16.85573,26.36667 -15.02582,58.44902 -14.83527,88.51793 L 55.881674,314.62612 c -16.309675,17.75051 -35.700379,32.82612 -49.2260678,53.01619 -14.4539857,20.75772 -3.209845,47.64315 13.1713228,63.09575 17.058994,19.5301 48.724755,24.1548 67.98469,5.1843 71.249161,-70.58191 141.865131,-141.86191 212.869241,-212.71281 16.98515,-2.39833 40.06776,2.73557 58.88562,-4.29979 45.5286,-10.09082 85.79888,-49.80352 88.43353,-99.00033 -0.3067,-12.85332 0.99384,-39.80807 -12.36564,-42.27984 -21.27881,21.31446 -42.55482,42.62198 -63.83362,63.93644 -18.03872,-3.69685 -36.15134,-7.33271 -54.21786-11.00783 l -12.24302,-55.18797 c 17.23503,-17.20478 34.46941,-34.41904 51.70444-51.62378 4.03856,-6.00838 14.41636,-9.42414 12.34812,-17.92602 -11.83503,-4.54634 -24.28658,-6.49259 -36.69404,-6.15633 z M 58.867989,367.4409 a 22.419273,22.418474 0 0 1 22.419272,22.41848 22.419273,22.418474 0 0 1 -22.419272,22.41848 22.419273,22.418474 0 0 1 -22.419271,-22.41848 22.419273,22.418474 0 0 1 22.419271,-22.41848 z" />
    </svg>
  </button>

  <!-- Main Container - Wider (max-w-4xl) but shorter (reduced padding) -->
  <div class="w-full max-w-4xl bg-white shadow-lg rounded-2xl overflow-hidden border border-gray-100">
    <!-- Header with Logo - Centered and Larger -->
    <div class="flex flex-col items-center justify-center gap-4 px-8 py-6 bg-white border-b border-gray-100">
      <!-- Increased logo size to h-24 -->
      <img src="assets/cst.png" alt="CST Logo" class="h-24 w-auto object-contain">
      <div class="text-center">
        <h1 class="text-2xl font-bold text-gray-900 m-0 tracking-tight">Connexion</h1>
        <p class="text-sm text-gray-500 mt-1">Canadian System Technology</p>
      </div>
    </div>

    <!-- Connecting State -->
    <div *ngIf="isConnecting" class="p-10 text-center">
      <div class="w-20 h-20 border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-6"></div>
      <h2 class="text-3xl font-bold text-gray-900 mb-3">Connexion en cours...</h2>
      <p class="text-lg text-gray-600 mb-4">Tentative de connexion au réseau WiFi</p>
      <p class="text-sm text-gray-400 font-mono bg-gray-50 px-4 py-2 rounded-lg inline-block">{{ currentApiUrl }}</p>
    </div>

    <!-- Connection Failed State - NEW 2-COLUMN DESIGN -->
    <div *ngIf="connectionFailed && !isConnecting" class="p-10">
      <h2 class="text-3xl font-bold text-gray-900 mb-2 text-center">Vérification de la connexion</h2>
      <p class="text-lg text-gray-600 mb-8 text-center">État de la connexion</p>

      <!-- 2-Column Grid -->
      <div class="grid grid-cols-3 gap-6 mb-8 max-w-3xl mx-auto">
        <!-- WiFi Connection Card  -->
        <div class="connection-status-card flex flex-col items-center justify-center text-center p-4">
          <!-- WiFi Icon -->
          <div class="w-20 h-20 rounded-full flex items-center justify-center mb-4"
            [ngClass]="isWifiConnected ? 'bg-green-100' : 'bg-red-100'">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 512 512" fill="currentColor"
              [ngClass]="isWifiConnected ? 'text-green-600' : 'text-red-600'">
              <path
                d="M508.059,174.525c-128.896-162.745-374.998-163.027-504.118,0 c-6.253,7.894-4.921,19.364,2.974,25.616s19.363,4.921,25.616-2.974c114.311-144.329,332.453-144.55,446.94,0 c6.256,7.901,17.725,9.222,25.616,2.974C512.981,193.887,514.312,182.419,508.059,174.525z" />
              <path
                d="M87.372,240.465c-6.255,7.893-4.927,19.362,2.966,25.616c7.896,6.257,19.363,4.925,25.616-2.966 c71.667-90.439,208.291-90.605,280.09,0c6.256,7.893,17.724,9.221,25.616,2.966c7.893-6.255,9.222-17.723,2.966-25.616 C338.355,131.595,173.775,131.429,87.372,240.465z" />
              <path
                d="M170.757,306.4c-6.25,7.897-4.916,19.364,2.981,25.615c7.897,6.25,19.365,4.916,25.615-2.981 c28.925-36.546,84.318-36.607,113.292,0c6.251,7.897,17.717,9.232,25.615,2.981c7.897-6.251,9.23-17.718,2.981-25.615 C297.724,251.418,214.345,251.33,170.757,306.4z" />
              <circle cx="256.003" cy="413.695" r="45.945" />
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">Wi-Fi</h3>
          <p class="text-sm font-semibold" [ngClass]="isWifiConnected ? 'text-green-600' : 'text-red-600'">
            {{ isWifiConnected ? 'Connecté' : 'Non connecté' }}
          </p>
        </div>


        <!-- Boat Card -->
        <div class="connection-status-card flex flex-col items-center justify-center text-center p-4">
          <img src="assets/boat.png" alt="Boat" class="w-48 h-48 object-contain">
        </div>



        <!-- Device Connection Card -->
        <div class="connection-status-card flex flex-col items-center justify-center text-center p-4">
          <!-- Device Icon -->
          <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 1024 1024" version="1.1"
              class="text-red-600">
              <path
                d="M512.3 959C265.3 959 65 758.8 65 511.8S265.3 64.5 512.3 64.5s447.2 200.2 447.2 447.2S759.3 959 512.3 959z"
                fill="currentColor" />
              <path
                d="M512.3 903.1c216.1 0 391.3-175.2 391.3-391.3S728.4 120.4 512.3 120.4 120.9 295.6 120.9 511.8s175.2 391.3 391.4 391.3z"
                fill="#FFFFFF" />
              <path
                d="M664.9 330.1c12.8-13.3 44.2 13.3 44.2 13.3 34.3 44.2 54.8 100.3 54.8 161.2 0 142.9-112.6 258.7-251.6 258.7S260.7 647.5 260.7 504.6c0-61.9 21.1-118.7 56.3-163.2 0 0 27.5-24.4 41.5-11.4s10.4 35.9 2.3 46.1c-28.5 36-44.3 80.9-44.3 128.5 0 112.3 88 202.8 195.7 202.8S707.9 617 707.9 504.6c0-46.9-15.4-91.2-43.1-127-7.9-10.2-12.8-34.2 0.1-47.5z"
                fill="currentColor" />
              <path
                d="M484.3 288.1c0-15.4 12.4-27.9 28-27.9 15.4 0 28 12.5 28 27.9v195.8c0 15.4-12.4 27.9-28 27.9-15.4 0-28-12.5-28-27.9V288.1z"
                fill="currentColor" />
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">Appareil</h3>
          <p class="text-sm font-semibold text-red-600">Non connecté</p>
        </div>
      </div>

      <!-- Scanning Countdown -->
      <div class="text-center hidden">
        <div class="inline-flex items-center gap-3 bg-gray-100 px-6 py-3 rounded-xl">
          <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div>
          <p class="text-gray-600 font-medium">Scanning pour appareils<span class="scanning-dots">...</span></p>
          <div class="bg-gray-200 px-3 py-1 rounded-lg">
            <span class="text-gray-700 font-bold text-lg">{{ retryCountdown }}s</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Connection Success State - NEW 2-COLUMN DESIGN -->
    <div *ngIf="connectionSuccess" class="p-10">
      <h2 class="text-3xl font-bold text-gray-900 mb-2 text-center">Connexion réussie</h2>
      <p class="text-lg text-gray-600 mb-8 text-center">Tous les systèmes sont opérationnels</p>

      <!-- 2-Column Grid -->
      <div class="grid grid-cols-3 gap-6 mb-8 max-w-3xl mx-auto">
        <!-- WiFi Connection Card -->
        <div class="connection-status-card flex flex-col items-center justify-center text-center p-4">
          <!-- WiFi Icon -->
          <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 512 512" fill="currentColor"
              class="text-green-600">
              <path
                d="M508.059,174.525c-128.896-162.745-374.998-163.027-504.118,0 c-6.253,7.894-4.921,19.364,2.974,25.616s19.363,4.921,25.616-2.974c114.311-144.329,332.453-144.55,446.94,0 c6.256,7.901,17.725,9.222,25.616,2.974C512.981,193.887,514.312,182.419,508.059,174.525z" />
              <path
                d="M87.372,240.465c-6.255,7.893-4.927,19.362,2.966,25.616c7.896,6.257,19.363,4.925,25.616-2.966 c71.667-90.439,208.291-90.605,280.09,0c6.256,7.893,17.724,9.221,25.616,2.966c7.893-6.255,9.222-17.723,2.966-25.616 C338.355,131.595,173.775,131.429,87.372,240.465z" />
              <path
                d="M170.757,306.4c-6.25,7.897-4.916,19.364,2.981,25.615c7.897,6.25,19.365,4.916,25.615-2.981 c28.925-36.546,84.318-36.607,113.292,0c6.251,7.897,17.717,9.232,25.615,2.981c7.897-6.251,9.23-17.718,2.981-25.615 C297.724,251.418,214.345,251.33,170.757,306.4z" />
              <circle cx="256.003" cy="413.695" r="45.945" />
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">Wi-Fi</h3>
          <p class="text-sm font-semibold text-green-600">Connecté</p>
        </div>


        <!-- Boat Card -->
        <div class="connection-status-card flex flex-col items-center justify-center text-center p-4">
          <img src="assets/boat.png" alt="Boat" class="w-60 h-60 object-contain">
        </div>


        <!-- Device Connection Card -->
        <div class="connection-status-card flex flex-col items-center justify-center text-center p-4">
          <!-- Device Icon -->
          <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 1024 1024" version="1.1"
              class="text-green-600">
              <path
                d="M512.3 959C265.3 959 65 758.8 65 511.8S265.3 64.5 512.3 64.5s447.2 200.2 447.2 447.2S759.3 959 512.3 959z"
                fill="currentColor" />
              <path
                d="M512.3 903.1c216.1 0 391.3-175.2 391.3-391.3S728.4 120.4 512.3 120.4 120.9 295.6 120.9 511.8s175.2 391.3 391.4 391.3z"
                fill="#FFFFFF" />
              <path
                d="M664.9 330.1c12.8-13.3 44.2 13.3 44.2 13.3 34.3 44.2 54.8 100.3 54.8 161.2 0 142.9-112.6 258.7-251.6 258.7S260.7 647.5 260.7 504.6c0-61.9 21.1-118.7 56.3-163.2 0 0 27.5-24.4 41.5-11.4s10.4 35.9 2.3 46.1c-28.5 36-44.3 80.9-44.3 128.5 0 112.3 88 202.8 195.7 202.8S707.9 617 707.9 504.6c0-46.9-15.4-91.2-43.1-127-7.9-10.2-12.8-34.2 0.1-47.5z"
                fill="currentColor" />
              <path
                d="M484.3 288.1c0-15.4 12.4-27.9 28-27.9 15.4 0 28 12.5 28 27.9v195.8c0 15.4-12.4 27.9-28 27.9-15.4 0-28-12.5-28-27.9V288.1z"
                fill="currentColor" />
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">Appareil</h3>
          <p class="text-sm font-semibold text-green-600">Connecté</p>
        </div>
      </div>

      <!-- Redirection Message -->
      <p class="text-center text-gray-600">Redirection dans 2 secondes...</p>
    </div>
  </div>

  <!-- Password Prompt Modal (FIRST STEP) -->
  <div *ngIf="showPasswordPrompt"
    class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4"
    (click)="closePasswordPrompt()">
    <div class="bg-white rounded-2xl w-full max-w-sm shadow-2xl border border-gray-100"
      (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="flex items-center justify-between px-6 py-5 border-b border-gray-100">
        <div>
          <h2 class="text-xl font-bold text-gray-900">Authentification</h2>
          <p class="text-sm text-gray-500 mt-0.5">Mot de passe requis</p>
        </div>
        <button (click)="closePasswordPrompt()"
          class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-gray-100 transition-all text-gray-400 hover:text-gray-600">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="p-6 space-y-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Mot de passe</label>
          <input type="password" [(ngModel)]="configPassword" placeholder="Entrez le mot de passe"
            (keyup.enter)="verifyPassword()"
            class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all" />
          <p class="text-xs text-gray-500 mt-2">Veuillez entrer le mot de passe pour accéder à la configuration</p>
        </div>

        <p *ngIf="passwordError"
          class="text-red-600 text-sm flex items-center gap-2 bg-red-50 px-4 py-3 rounded-xl border border-red-100">
          <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
              clip-rule="evenodd" />
          </svg>
          <span>{{ passwordError }}</span>
        </p>
      </div>

      <!-- Modal Footer -->
      <div class="px-6 py-5 bg-gray-50 border-t border-gray-100 flex items-center justify-end rounded-b-2xl">
        <div class="flex gap-3">
          <button (click)="closePasswordPrompt()"
            class="px-5 py-2.5 bg-white text-gray-700 rounded-xl hover:bg-gray-100 transition-all font-semibold text-sm border border-gray-200">
            Annuler
          </button>
          <button (click)="verifyPassword()"
            class="px-5 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all font-semibold text-sm shadow-md shadow-blue-100">
            Vérifier
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- API Configuration Modal (SECOND STEP - Only shown after password is correct) -->
  <div *ngIf="showApiConfig"
    class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4"
    (click)="closeApiConfig()">
    <div class="bg-white rounded-2xl w-full max-w-md shadow-2xl border border-gray-100"
      (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="flex items-center justify-between px-6 py-5 border-b border-gray-100">
        <div>
          <h2 class="text-xl font-bold text-gray-900">Configuration API</h2>
          <p class="text-sm text-gray-500 mt-0.5">URL de l'appareil</p>
        </div>
        <button (click)="closeApiConfig()"
          class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-gray-100 transition-all text-gray-400 hover:text-gray-600">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="p-6 space-y-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">URL de l'API de l'appareil</label>
          <input type="text" [(ngModel)]="customApiUrl" placeholder="http://192.168.1.251"
            class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-sm font-mono focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all" />
          <p class="text-xs text-gray-500 mt-2">Exemple: http://192.168.1.251 ou http://device.local</p>
        </div>

        <p *ngIf="apiUrlError"
          class="text-red-600 text-sm flex items-center gap-2 bg-red-50 px-4 py-3 rounded-xl border border-red-100">
          <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
              clip-rule="evenodd" />
          </svg>
          <span>{{ apiUrlError }}</span>
        </p>

        <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
          <div class="text-xs font-semibold text-blue-700 uppercase tracking-wider mb-1">URL actuelle</div>
          <div class="font-mono text-sm text-blue-900">{{ currentApiUrl }}</div>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="px-6 py-5 bg-gray-50 border-t border-gray-100 flex items-center justify-end rounded-b-2xl">
        <div class="flex gap-3">
          <button (click)="closeApiConfig()"
            class="px-5 py-2.5 bg-white text-gray-700 rounded-xl hover:bg-gray-100 transition-all font-semibold text-sm border border-gray-200">
            Annuler
          </button>
          <button (click)="saveApiConfig()"
            class="px-5 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all font-semibold text-sm shadow-md shadow-blue-100">
            Enregistrer
          </button>
        </div>
      </div>
    </div>
  </div>
</div>